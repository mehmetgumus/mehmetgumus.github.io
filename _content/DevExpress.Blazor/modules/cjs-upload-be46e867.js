DxBlazorInternal.define("cjs-upload-be46e867.js",function(e,n,t){e("./cjs-chunk-9eab2df8.js");var o=e("./cjs-dom-utils-9e3f000c.js"),i=e("./cjs-chunk-f8581dee.js"),r="chunkMetadata",a={WaitingStart:0,PendingUpload:1,Uploading:2,Paused:3,Complete:4,Canceled:5,Error:6,Removing:7},s={Instant:0,OnButtonClick:1};function l(e,n,t,r,a){var s;e=o.EnsureElement(e),t=o.EnsureElement(t),r=n.buttonCssSelector?document.querySelector(n.buttonCssSelector):o.EnsureElement(r),n.dropZoneCssSelector&&(s=document.querySelector(n.dropZoneCssSelector)),t&&i.DisposeEvents(t),r&&i.DisposeEvents(r),s&&i.DisposeEvents(s);var l,c=null,f=null,d=null,h=null;return e.files||(e.files=[]),t&&(n.multiple&&t.setAttribute("multiple",""),n.acceptedFileTypes&&t.setAttribute("accept",n.acceptedFileTypes.join(",")),c=function(o){u(t.files,a,n).then(function(o){m(o,n,e,a),t.value=""})},o.AttachEventToElement(t,"change",c),r&&o.AttachEventToElement(r,"click",f=function(){t.click()}),s&&(d=function(t){t.preventDefault(),u(function(e,n){var t=[];if(e.items)for(var o=0,i=e.items[o];i;i=e.items[++o])"file"===i.kind&&i.type&&t.push(i.getAsFile());else for(var r=0,a=e.files[r];a;a=e.files[++r])t.push(a);return function(e,n){if(!e.length||!n)return e;for(var t=[],o=function(e){return e.map(function(e){return e.trim()})}(n),i=0,r=e.length;i<r;i++)p(e[i],o)&&t.push(e[i]);return t}(n.multiple?t:[t[0]],n.acceptedFileTypes)}(t.dataTransfer,n),a,n).then(function(t){m(t,n,e,a)}),l(t)},h=function(e){n.dragOverClassName&&o.AddClassNameToElement(e.srcElement,n.dragOverClassName),e.preventDefault()},l=function(e){n.dragOverClassName&&o.RemoveClassNameFromElement(e.srcElement,n.dragOverClassName)},o.AttachEventToElement(s,"drop",d),o.AttachEventToElement(s,"dragover",h),o.AttachEventToElement(s,"dragleave",l))),i.RegisterDisposableEvents(t,function(){c&&o.DetachEventFromElement(t,"change",c)}),r&&i.RegisterDisposableEvents(r,function(){o.DetachEventFromElement(r,"click",f)}),s&&i.RegisterDisposableEvents(s,function(){o.DetachEventFromElement(s,"drop",d),o.DetachEventFromElement(s,"dragover",h),o.DetachEventFromElement(s,"dragover",l)}),Promise.resolve("ok")}function u(e,n,t){return new Promise(function(o,i){n.invokeMethodAsync("CreateFileGuids",e.length).then(function(n){for(var i=[],r=0,a=e[r];a;a=e[++r]){var s=c(a,n[r],t);i.push(s)}o(i)})})}function c(e,n,t){var o={value:e,fileInfo:{name:e.name,size:e.size,type:e.type,guid:n},status:t.uploadMode===s.Instant?a.PendingUpload:a.WaitingStart,loadedBytes:0,isFileExtensionValid:f(e,t),isMinSizeValid:h(e,t),isMaxSizeValid:d(e,t),isValid:function(){return this.isFileExtensionValid&&this.isMaxSizeValid&&this.isMinSizeValid},isUploadComplete:function(){return this.loadedBytes>=this.fileInfo.size},loadStart:function(){this.status!==a.Uploading&&(this.status=a.Uploading,this.onLoadStart&&this.onLoadStart.call(this))},progress:function(){this.onProgress&&this.onProgress.call(this)},pause:function(){this.status=a.Paused,this.onPause&&this.onPause.call(this)},loadEnd:function(){this.isUploadComplete()&&(this.status=a.Complete,this.onLoadEnd&&this.onLoadEnd.call(this))},abort:function(){this.status!==a.Canceled&&(this.status=a.Canceled,this.request&&this.request.abort(),this.onAbort&&this.onAbort.call(this))},error:function(e){this.status=a.Error,this.onError&&this.onError.call(this,e)}};return o.isValid()&&t.uploadUrl||(o.status=a.Error),o}function f(e,n){var t=n.allowedFileExtensions,o=e.name.substring(e.name.lastIndexOf(".")).toLowerCase();if(0===t.length)return!0;for(var i=0;i<t.length;i++)if(o===t[i].toLowerCase())return!0;return!1}function d(e,n){var t=n.maxFileSize;return!(t>0)||e.size<=t}function h(e,n){var t=n.minFileSize;return!(t>0)||e.size>=t}function p(e,n){return n.some(function(n){if("."===n[0]){if(n=n.replace(".","\\."),e.name.match(new RegExp(n+"$","i")))return!0}else if(n=n.replace("*",""),e.type.match(new RegExp(n,"i")))return!0})}function m(e,n,t,o){0!==e.length&&(t.files=t.files.concat(e),F(t.files,o),e.forEach(function(e){E(e,n,t,o)}))}function E(e,n,t,o){e&&e.isValid()&&e.status!==a.WaitingStart&&e.status!==a.Error&&(!function(e,n){e.onLoadStart=function(){!function(e,n){I("FileUploadStarted",e,n)}(e,n)},e.onProgress=function(){!function(e,n){I("FileProgress",e,n)}(e,n)},e.onAbort=function(){!function(e,n){I("FileUploadAborted",e,n)}(e,n)},e.onPause=function(){!function(e,n){I("FileUploadPaused",e,n)}(e,n)},e.onError=function(t){!function(e,n,t,o){o.invokeMethodAsync("FileUploadError",b(e),n,t)}(e,t.status,t.statusText,n)},e.onLoadEnd=function(){!function(e,n){I("FileUploaded",e,n)}(e,n)}}(e,o),function(e){return e.chunkSize>0?v:g}(n).upload(e,n,function(e){e.loadEnd(),e.isUploadComplete()||e.status!==a.Uploading||E(e,n,t,o)}))}var v={upload:function(e,n,t){if(e){e.totalChunkCount||(e.chunkIndex=0,e.totalChunkCount=function(e,n){var t=Math.trunc(e/n.chunkSize);return e%n.chunkSize>0&&t++,t}(e.fileInfo.size,n));var o=n.chunkSize*e.chunkIndex,i=e.value.slice(o,o+n.chunkSize),a=function(e,n,t){var o=new FormData;return o.append(e,n),o.append(r,JSON.stringify({FileName:t.fileInfo.name,FileSize:t.fileInfo.size,FileType:t.fileInfo.type,FileGuid:t.fileInfo.guid,Index:t.chunkIndex,TotalCount:t.totalChunkCount})),o}(n.name,i,e);e.request=S.sendRequest(a,{url:n.uploadUrl,method:"POST",headers:[],onAbort:function(n){e.abort()},onProgress:function(e){},onError:function(n){e.error(n.target)},onLoadStart:function(n){e.loadStart()},onLoad:function(n){200===n.target.status?(e.chunkIndex++,e.loadedBytes+=i.size,e.progress(),t(e)):e.error(n.target)}})}}},g={upload:function(e,n,t){if(e){var o=function(e,n){var t=new FormData;return t.append(e,n.value),t}(n.name,e);e.request=S.sendRequest(o,{url:n.uploadUrl,method:"POST",headers:[],onProgress:function(n){e.loadedBytes=n.loaded>e.fileInfo.size?e.fileInfo.size:n.loaded,e.progress()},onAbort:function(n){e.abort()},onError:function(n){e.error(n.target)},onLoadStart:function(n){e.loadStart()},onLoad:function(n){200===n.target.status?t(e,n):e.error(n.target)}})}}},S={sendRequest:function(e,n,t){var o=new XMLHttpRequest;n.crossDomain=function(e){var n=!1,t=document.createElement("a"),o=document.createElement("a");t.href=window.location.href;try{o.href=e,o.href=o.href,n=t.protocol+"//"+t.host!=o.protocol+"//"+o.host}catch(e){n=!0}return n}(n.url);var i=function(e){var n=e.headers||{};return n.Accept=n.Accept||"*/*",e.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest"),n}(n);for(var r in o.open(n.method,n.url,!0),n.onLoadStart&&(o.upload.onloadstart=n.onLoadStart),n.onLoad&&(o.onload=n.onLoad),n.onLoadEnd&&(o.upload.onloadend=n.onLoadEnd),n.onProgress&&(o.upload.onprogress=n.onProgress),n.onError&&(o.upload.onerror=n.onError),n.onAbort&&(o.upload.onabort=n.onAbort),i)Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&o.setRequestHeader(r,i[r]);return o.send(e),{abort:function(){o.abort()}}}};function F(e,n){n.invokeMethodAsync("SelectedFilesChanged",e.map(function(e){return b(e)}))}function I(e,n,t){t.invokeMethodAsync(e,b(n))}function b(e){return{Name:e.fileInfo.name,Size:e.fileInfo.size,Type:e.fileInfo.type,Guid:e.fileInfo.guid,LoadedBytes:e.loadedBytes,Status:e.status,IsFileExtensionValid:e.isFileExtensionValid,IsMinSizeValid:e.isMinSizeValid,IsMaxSizeValid:e.isMaxSizeValid}}function C(e,n,t,o){t.files.forEach(function(i){e.forEach(function(e){i.fileInfo.guid===e&&(i.status=a.PendingUpload,E(i,n,t,o))})})}function k(e,n,t,o){t.files.forEach(function(n){e.forEach(function(e){n.fileInfo.guid===e&&n.pause()})})}function z(e,n,t,o){t.files.forEach(function(n){e.forEach(function(e){n.fileInfo.guid===e&&n.abort()})})}function y(e,n,t,o){var i=t.files.filter(function(n){return e.indexOf(n.fileInfo.guid)>-1});0!==!i.length&&(t.files=P(t.files,e),u(i.map(function(e){return e.value}),o,n).then(function(i){t.files=t.files.concat(i),function(e,n,t){t.invokeMethodAsync("FileReloaded",e,n)}(e,i.map(function(e){return e.fileInfo.guid}),o),i.forEach(function(e){e.status=a.PendingUpload,E(e,n,t,o)})}))}function A(e,n,t,o){t.files=P(t.files,e),F(t.files,o)}function P(e,n){return e.filter(function(e){return-1===n.indexOf(e.fileInfo.guid)})}function U(e){if(e=o.EnsureElement(e))return i.DisposeEvents(e),Promise.resolve("ok")}var x={Init:l,Dispose:U,StartFileUpload:C,PauseFileUpload:k,AbortFileUpload:z,RemoveFiles:A,ReloadFile:y};t.AbortFileUpload=z,t.Dispose=U,t.Init=l,t.PauseFileUpload=k,t.ReloadFile=y,t.RemoveFiles=A,t.StartFileUpload=C,t.default=x},["cjs-chunk-9eab2df8.js","cjs-dom-utils-9e3f000c.js","cjs-chunk-f8581dee.js"]);
